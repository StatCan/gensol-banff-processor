
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Banff Processor User Guide &#8212; Banff Processor 2.0.2 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=2a807888" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=29701289"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'en/processor-user-guide';</script>
    <link rel="index" title="Index" href="../genindex" />
    <link rel="search" title="Search" href="../search" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/banff_white.png" class="logo__image only-light" alt="Banff Processor 2.0.2 documentation - Home"/>
    <img src="../_static/banff_white.png" class="logo__image only-dark pst-js-only" alt="Banff Processor 2.0.2 documentation - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="index">
    English
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../fr/index">
    Français
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/StatCan/gensol-banff-processor" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="index">
    English
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../fr/index">
    Français
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/StatCan/gensol-banff-processor" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Banff Processor User Guide</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="banff-processor-user-guide">
<h1>Banff Processor User Guide<a class="headerlink" href="#banff-processor-user-guide" title="Link to this heading">#</a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">#</a></h2>
<p>The Banff Processor is a Python package used to execute a Statistical Data Editing (SDE) process, also commonly referred to as Edit and Imputation (E&amp;I). A specific SDE process typically consists of numerous individual process steps, each executing a SDE function such as error localization, outlier detection, or imputation. The process flow describes which process steps to perform and the sequence in which they are executed. Given a set of input metadata tables that describe the SDE process flow, including each individual step, the Banff processor executes each process step in sequence, managing all intermediate data management. The advantage of the Banff Processor’s metadata-driven system is that the design and modification of the SDE process is managed from metadata tables instead of source code.</p>
<p>Other notes about the Banff Processor:</p>
<ul class="simple">
<li><p>Simplicity: Once the metadata tables are created, the processor can be executed from a single line of code</p></li>
<li><p>Efficiency: Designed for production-level SDE processes</p></li>
<li><p>Modularity: Within a process step, users may call the built-in Banff procedures, or <a class="reference internal" href="#user-defined-procedures">user defined Procedures</a></p></li>
<li><p>Flexibility: <a class="reference internal" href="#process-controls">Process Controls</a> and <a class="reference internal" href="#process-blocks">Process Blocks</a> allow users to specify complex process flows</p></li>
<li><p>Informative: The Processor produces diagnostics from each step, and for the overall process</p></li>
<li><p>Transparency: Source code is available and freely shared</p></li>
</ul>
<p>The user guide often uses terminology from the <a class="reference external" href="https://statswiki.unece.org/spaces/sde/pages/117771706/GSDEM">Generic Statistical Data Editing Model (GSDEM)</a>. Users are encouraged to reference the GSDEM for common terminology regarding SDE concepts.</p>
</section>
<section id="table-of-contents">
<h2>Table of Contents<a class="headerlink" href="#table-of-contents" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="#input-metadata-files">Input Metadata Files</a></p></li>
<li><p><a class="reference internal" href="#metadata-generation-tool">Metadata Generation Tool</a></p></li>
<li><p><a class="reference internal" href="#banff-processor-input-parameters">Input Parameters</a></p></li>
<li><p><a class="reference internal" href="#executing-the-processor-as-a-command-line-utility">Executing the processor as a command line utility</a></p></li>
<li><p><a class="reference internal" href="#executing-the-processor-from-within-a-python-script">Executing the processor from within a python process</a></p></li>
<li><p><a class="reference internal" href="#user-defined-procedures">User Defined Procedures</a></p></li>
<li><p><a class="reference internal" href="#process-controls">Process Controls</a></p></li>
<li><p><a class="reference internal" href="#process-blocks">Process Blocks</a></p></li>
<li><p><a class="reference internal" href="#output">Output</a></p></li>
</ul>
</section>
<section id="input-metadata-files">
<h2>Input Metadata Files<a class="headerlink" href="#input-metadata-files" title="Link to this heading">#</a></h2>
<p>The Banff Processor is driven by metadata tables describing both the overall process flow, as well as the parameters required for individual process steps. The primary metadata table is called JOBS, which specifies the overall process flow, specifically the built-in Banff procedures and/or user-defined programs (plugins) to execute and their relative sequencing. The JOBS table can contain more than one job (i.e., process flow), specified by the <code class="docutils literal notranslate"><span class="pre">jobid</span></code> (job identifier), though only one job can be executed at a time by the Banff Processor. Each job will include one row per process step; the key columns are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">jobid</span></code>: Job identifier.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">seqno</span></code>: Sequence number of the individual process steps.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">process</span></code>: Name of either the built-in procedure or user-defined program to execute at each process step.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">specid</span></code>: Specification identifier, linking to other metadata tables containing parameters specific to the declared <code class="docutils literal notranslate"><span class="pre">process</span></code>.</p></li>
</ul>
<p>Additional columns on the JOBS table include an optional process control identifier (<code class="docutils literal notranslate"><span class="pre">controlid</span></code>) as well as parameters that are common to multiple procedures (<code class="docutils literal notranslate"><span class="pre">editgroupid</span></code>,<code class="docutils literal notranslate"><span class="pre">byid</span></code>,<code class="docutils literal notranslate"><span class="pre">acceptnegative</span></code>).</p>
<p>Overall, the Banff Processor uses 18 metadata tables, which can be classified as follows:</p>
<ul class="simple">
<li><p>Tables describing the overall process flow: <code class="docutils literal notranslate"><span class="pre">JOBS</span></code> <code class="docutils literal notranslate"><span class="pre">PROCESSCONTROLS</span></code></p></li>
<li><p>Process step parameters for built-in Banff procedures: <code class="docutils literal notranslate"><span class="pre">VERIFYEDITSPECS</span></code> <code class="docutils literal notranslate"><span class="pre">OUTLIERSPECS</span></code> <code class="docutils literal notranslate"><span class="pre">ERRORLOCSPECS</span></code> <code class="docutils literal notranslate"><span class="pre">DONORSPECS</span></code> <code class="docutils literal notranslate"><span class="pre">ESTIMATORSPECS</span></code> <code class="docutils literal notranslate"><span class="pre">ESTIMATORS</span></code> <code class="docutils literal notranslate"><span class="pre">ALGORITHMS</span></code> <code class="docutils literal notranslate"><span class="pre">PRORATESPECS</span></code> <code class="docutils literal notranslate"><span class="pre">MASSIMPUTATIONSPECS</span></code></p></li>
<li><p>Process step parameters for <a class="reference internal" href="#user-defined-procedures">User Defined Procedures</a>: <code class="docutils literal notranslate"><span class="pre">USERVARS</span></code></p></li>
<li><p>Tables used to define edits: <code class="docutils literal notranslate"><span class="pre">EDITS</span></code> <code class="docutils literal notranslate"><span class="pre">EDITGROUPS</span></code></p></li>
<li><p>Parameters used by multiple procedures: <code class="docutils literal notranslate"><span class="pre">VARLISTS</span></code> <code class="docutils literal notranslate"><span class="pre">WEIGHTS</span></code> <code class="docutils literal notranslate"><span class="pre">EXPRESSIONS</span></code></p></li>
<li><p>Data management: <code class="docutils literal notranslate"><span class="pre">PROCESSOUTPUTS</span></code></p></li>
</ul>
<p>Only the JOBS table is mandatory, though other tables are required depending on which procedures or options are used. A full description of all metadata tables is included in this document: <a class="reference internal" href="metadata-tables"><span class="std std-doc">Metadata Tables</span></a></p>
<section id="formatting">
<h3>Formatting<a class="headerlink" href="#formatting" title="Link to this heading">#</a></h3>
<p>The metadata tables must be saved in <code class="docutils literal notranslate"><span class="pre">.xml</span></code> format. Users may create the <code class="docutils literal notranslate"><span class="pre">.xml</span></code> files on their own, or use the <a class="reference download internal" download="" href="../_downloads/c34605131b43615675625caf82015946/banffprocessor_template.xlsx"><span class="xref download myst">Banff Processor Template</span></a> to create and save the metadata, and the <a class="reference internal" href="#metadata-generation-tool">Metadata Generation Tool</a> to convert the template file into <code class="docutils literal notranslate"><span class="pre">.xml</span></code> tables. By default, the Processor will look for the XML files in the same location as your <code class="docutils literal notranslate"><span class="pre">.json</span></code> input file, either directly in the same folder or in a <code class="docutils literal notranslate"><span class="pre">\metadata</span></code> subfolder. Alternatively, you may provide a specific location by setting the <code class="docutils literal notranslate"><span class="pre">metadata_folder</span></code> parameter in your input JSON file.</p>
</section>
<section id="example-jobs-table">
<h3>Example (JOBS table)<a class="headerlink" href="#example-jobs-table" title="Link to this heading">#</a></h3>
<p>The following table defines a single job, “Main”, which includes four process steps.</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>jobid</p></th>
<th class="head"><p>seqno</p></th>
<th class="head"><p>controlid</p></th>
<th class="head"><p>process</p></th>
<th class="head"><p>specid</p></th>
<th class="head"><p>edigroupid</p></th>
<th class="head"><p>byid</p></th>
<th class="head"><p>acceptnegative</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Main</p></td>
<td><p>1</p></td>
<td><p></p></td>
<td><p>ERRORLOC</p></td>
<td><p>errloc_specs</p></td>
<td><p>edits_1</p></td>
<td><p></p></td>
<td><p>Y</p></td>
</tr>
<tr class="row-odd"><td><p>Main</p></td>
<td><p>2</p></td>
<td><p></p></td>
<td><p>DETERMINISTIC</p></td>
<td><p></p></td>
<td><p>edits_1</p></td>
<td><p></p></td>
<td><p>Y</p></td>
</tr>
<tr class="row-even"><td><p>Main</p></td>
<td><p>10</p></td>
<td><p></p></td>
<td><p>DONORIMP</p></td>
<td><p>donor_specs</p></td>
<td><p>edits_1</p></td>
<td><p>by_list</p></td>
<td><p>Y</p></td>
</tr>
<tr class="row-odd"><td><p>Main</p></td>
<td><p>99</p></td>
<td><p></p></td>
<td><p>PRORATE</p></td>
<td><p>pro_specs</p></td>
<td><p>edits_2</p></td>
<td><p></p></td>
<td><p>Y</p></td>
</tr>
</tbody>
</table>
</div>
<ul class="simple">
<li><p>Only the ordering of the sequence numbers (<code class="docutils literal notranslate"><span class="pre">seqno</span></code>) are important; they do not need to be sequential integers.</p></li>
<li><p>This job includes four process steps, run sequentially, consisting of four built-in Banff procedures: <code class="docutils literal notranslate"><span class="pre">errorloc</span></code>, <code class="docutils literal notranslate"><span class="pre">deterministic</span></code>, <code class="docutils literal notranslate"><span class="pre">donorimp</span></code>, and <code class="docutils literal notranslate"><span class="pre">prorate</span></code>.</p></li>
<li><p>The parameters <code class="docutils literal notranslate"><span class="pre">editgroupid</span></code>, <code class="docutils literal notranslate"><span class="pre">byid</span></code> and <code class="docutils literal notranslate"><span class="pre">acceptnegative</span></code>, which are common to many of the built-in Banff procedures, are included in the JOBS table.</p></li>
<li><p>Most procedures include mandatory and/or optional parameters that define exactly how the procedure should be executed. These are contained in additional metadata tables, and linked to specific process steps via the <code class="docutils literal notranslate"><span class="pre">specid</span></code> column. Procedures that do not have any additional parameters (beyond those included in the JOBS table) do not require a <code class="docutils literal notranslate"><span class="pre">specid</span></code>.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">controlid</span></code> column is optional, and can be used to specify <a class="reference internal" href="#process-controls">Process Controls</a>.</p></li>
</ul>
<p>Additional examples can be found in the project’s ‘examples’ folder.</p>
</section>
</section>
<section id="metadata-generation-tool">
<h2>Metadata Generation Tool<a class="headerlink" href="#metadata-generation-tool" title="Link to this heading">#</a></h2>
<p>Metadata stored in the <a class="reference download internal" download="" href="../_downloads/c34605131b43615675625caf82015946/banffprocessor_template.xlsx"><span class="xref download myst">Banff Processor Template</span></a> must be converted to XML files before running the processor. A conversion tool is provided for this purpose. With the banffprocessor package installed in your python environment, the conversion tool can be run with the following command:</p>
<!--CLI documentation: (not sure how to document BOTH long and short flag if they have a value)-->
<!--banffconvert INPUT-FILE [--outdir=OUTPUT-FOLDER, -o OUTPUT-FOLDER]-->
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>banffconvert<span class="w"> </span><span class="s2">&quot;\path\to\your\excel_metadata.xlsx&quot;</span><span class="w"> </span>-o<span class="w"> </span><span class="s2">&quot;\my\output\directory&quot;</span><span class="w"> </span>-l<span class="w"> </span>fr
</pre></div>
</div>
<p>or:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>banffconvert<span class="w"> </span><span class="s2">&quot;\path\to\your\excel_metadata.xlsx&quot;</span><span class="w"> </span>--outdir<span class="o">=</span><span class="s2">&quot;\my\output\directory&quot;</span><span class="w"> </span>--lang<span class="w"> </span>en
</pre></div>
</div>
<p>Alternatively to run as a module:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>banffprocessor.util.metadata_excel_to_xml<span class="w"> </span><span class="s2">&quot;\path\to\your\excel_metadata.xlsx&quot;</span><span class="w"> </span>-o<span class="w"> </span><span class="s2">&quot;\my\output\directory&quot;</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>NOTE</strong>: The ‘-o’/’–outdir’ parameter is optional. If it is not provided the conversion tool will save XML files to the same directory as the input file.</p></li>
<li><p><strong>NOTE</strong>: The ‘-l’/’–lang’ parameter is optional. Valid values include en and fr, if not specified, the default is set to en.</p></li>
</ul>
<p>Finally, the tool can be included and ran directly in a python script:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">banffprocessor.util.metadata_excel_to_xml</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">e2x</span>

<span class="n">e2x</span><span class="o">.</span><span class="n">convert_excel_to_xml</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">path</span><span class="se">\\</span><span class="s2">to</span><span class="se">\\</span><span class="s2">your</span><span class="se">\\</span><span class="s2">excel_metadata.xlsx&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">my</span><span class="se">\\</span><span class="s2">output</span><span class="se">\\</span><span class="s2">directory&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="banff-processor-input-parameters">
<h2>Banff Processor Input Parameters<a class="headerlink" href="#banff-processor-input-parameters" title="Link to this heading">#</a></h2>
<p>Input parameters are specified in a <code class="docutils literal notranslate"><span class="pre">.json</span></code> file or a <code class="docutils literal notranslate"><span class="pre">ProcessorInput</span></code> object, either of which are passed to the processor and used to specify your job’s parameters. These are the parameters that are currently available:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Purpose</p></th>
<th class="head"><p>Required?</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>job_id</p></td>
<td><p>The job id from your <code class="docutils literal notranslate"><span class="pre">jobs.xml</span></code> you wish to run.</p></td>
<td><p>Y</p></td>
</tr>
<tr class="row-odd"><td><p>unit_id</p></td>
<td><p>The unit id variable is the unique identifier on micro data files for the job</p></td>
<td><p>Y</p></td>
</tr>
<tr class="row-even"><td><p>indata_filename</p></td>
<td><p>The filename or full filepath of your input/current data file</p></td>
<td><p>Y (unless running only <em>VerifyEdits</em>)</p></td>
</tr>
<tr class="row-odd"><td><p>indata_aux_filename</p></td>
<td><p>The filename or full filepath of your auxiliary data file</p></td>
<td><p>N</p></td>
</tr>
<tr class="row-even"><td><p>indata_hist_filename</p></td>
<td><p>The filename or full filepath of your historic data file</p></td>
<td><p>N</p></td>
</tr>
<tr class="row-odd"><td><p>instatus_hist_filename</p></td>
<td><p>The filename or full filepath of your historic status data file</p></td>
<td><p>N</p></td>
</tr>
<tr class="row-even"><td><p>instatus_filename</p></td>
<td><p>The filename or full filepath of a status file to use as input to the first proc in your job requiring a status file. <a class="footnote-reference brackets" href="#id2" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a></p></td>
<td><p>N</p></td>
</tr>
<tr class="row-odd"><td><p>user_plugins_folder</p></td>
<td><p>The optional location of the folder containing your custom python procedure plugins. <em>See below for a description of how to create your own plugins</em></p></td>
<td><p>N</p></td>
</tr>
<tr class="row-even"><td><p>metadata_folder</p></td>
<td><p>The optional path to a folder where your XML metadata can be found</p></td>
<td><p>N</p></td>
</tr>
<tr class="row-odd"><td><p>output_folder</p></td>
<td><p>The optional path to a folder where your output files will be saved</p></td>
<td><p>N</p></td>
</tr>
<tr class="row-even"><td><p>process_output_type</p></td>
<td><p>Controls the output datasets retained by each process. Options include <code class="docutils literal notranslate"><span class="pre">all</span></code>, <code class="docutils literal notranslate"><span class="pre">minimal</span></code> and <code class="docutils literal notranslate"><span class="pre">custom</span></code>. When <code class="docutils literal notranslate"><span class="pre">all</span></code> is specified all outputs are retained. If <code class="docutils literal notranslate"><span class="pre">minimal</span></code> is specified, only the imputed_file, status_file and status_log are retained. When the value is ‘custom’, the processor looks at the <code class="docutils literal notranslate"><span class="pre">ProcessOutputs</span></code> metadata to determine what to keep.</p></td>
<td><p>N</p></td>
</tr>
<tr class="row-odd"><td><p>seed</p></td>
<td><p>The seed value to use for consistent results when using the same input data and parameters</p></td>
<td><p>N</p></td>
</tr>
<tr class="row-even"><td><p>no_by_stats</p></td>
<td><p>If specified, determines if no_by_stats is set to True when calling standard procedures.</p></td>
<td><p>N</p></td>
</tr>
<tr class="row-odd"><td><p>randnumvar</p></td>
<td><p>Specify a random number variable to be used when having to make a choice during error localization or donor imputation. This parameter is optional and is only used by ErrorLoc and DonorImputation simultaneously (it cannot be used in one and not the other). Please see the Banff User Guide document for more details on the use of the <code class="docutils literal notranslate"><span class="pre">randnumvar</span></code> option in the ErrorLoc and DonorImputation procedures.<br><br>This option can be helpful when one needs to get the same error localization or imputation results from one run to the next.</p></td>
<td><p>N</p></td>
</tr>
<tr class="row-even"><td><p>save_format</p></td>
<td><p>Optional list of file extensions used to determine the format to save output files in. One or more may be provided. Currently supports CSV and Parquet extensions.</p></td>
<td><p>N</p></td>
</tr>
<tr class="row-odd"><td><p>log_level</p></td>
<td><p>Configures whether or not to create a log file and what level of messages it should contain. Value should be 0, 1 (default) or 2. See <a class="reference internal" href="#output">Output</a>.</p></td>
<td><p>N</p></td>
</tr>
</tbody>
</table>
</div>
<p>Example JSON input file:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;j1&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;unit_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ident&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;indata_filename&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;indata.parq&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;indata_aux_filename&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;C:\\full\\filepath\\to\\auxdata.parq&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;indata_hist_filename&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;histdata.parq&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;instatus_hist_filename&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;histstatus.parq&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;instatus_filename&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;instatus.parq&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;user_plugins_folder&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;C:\\path\\to\\my\\plugins&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;metadata_folder&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;C:\\path\\to\\xml\\metadata&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;output_folder&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;my_output_subfolder&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;process_output_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;All&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;seed&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1234</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;no_by_stats&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;N&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;randnumvar&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;save_format&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;.parq&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;.csv&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;log_level&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Example building a <code class="docutils literal notranslate"><span class="pre">ProcessorInput</span></code> object inline:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">banffprocessor.processor</span><span class="w"> </span><span class="kn">import</span> <span class="n">Processor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">banffprocessor.processor_input</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProcessorInput</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="c1"># Supplying parameters directly, instead of an input file</span>
<span class="n">input_params</span> <span class="o">=</span> <span class="n">ProcessorInput</span><span class="p">(</span><span class="n">job_id</span><span class="o">=</span><span class="s2">&quot;j1&quot;</span><span class="p">,</span> 
                              <span class="n">unit_id</span><span class="o">=</span><span class="s2">&quot;ident&quot;</span><span class="p">,</span>
                              <span class="c1"># Gets the path to the folder containing this file</span>
                              <span class="n">input_folder</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span>
                              <span class="n">indata_filename</span><span class="o">=</span><span class="s2">&quot;indata.parq&quot;</span><span class="p">,</span>
                              <span class="n">indata_hist_filename</span><span class="o">=</span><span class="s2">&quot;C:</span><span class="se">\\</span><span class="s2">full</span><span class="se">\\</span><span class="s2">filepath</span><span class="se">\\</span><span class="s2">to</span><span class="se">\\</span><span class="s2">histdata.parq&quot;</span><span class="p">,</span>
                              <span class="n">seed</span><span class="o">=</span><span class="mi">1234</span><span class="p">,</span> 
                              <span class="n">save_format</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;.parq&quot;</span><span class="p">,</span> <span class="s2">&quot;.csv&quot;</span><span class="p">],</span>
                              <span class="n">log_level</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Normal method with a JSON file</span>
<span class="c1">#my_bp = Processor(&quot;C:\\path\\to\\my\\processor_input.json&quot;)</span>
<span class="c1"># Method when providing parameters inline</span>
<span class="n">my_bp</span> <span class="o">=</span> <span class="n">Processor</span><span class="p">(</span><span class="n">input_params</span><span class="p">)</span>
</pre></div>
</div>
<p>Notes:</p>
<ul class="simple">
<li><p>All folder locations may be given as absolute filepaths or relative to the input folder (either the location of the input .json file or the supplied input_folder parameter if creating inputs inline as demonstrated above).</p>
<ul>
<li><p>This input_folder location is also used as the default location for other files required by the processor should no value be provided for them, such as metadata, input data files and user-defined procedures</p></li>
</ul>
</li>
<li><p>File paths must have any backslashes <code class="docutils literal notranslate"><span class="pre">\</span></code> escaped by replacing them with a double-backslash <code class="docutils literal notranslate"><span class="pre">\\</span></code>. For example, <code class="docutils literal notranslate"><span class="pre">C:\this\is\a\filepath</span></code> would become <code class="docutils literal notranslate"><span class="pre">C:\\this\\is\\a\\filepath</span></code></p></li>
<li><p>Fields that are not required to run the procedures outlined in your jobs file can be omitted or left empty</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">CSV</span></code> format has been included for testing purposes and is not intended for production, parquet is currently the recommended format for production for reasons related to accuracy, performance and efficiency</p></li>
</ul>
</section>
<section id="executing-the-processor-as-a-command-line-utility">
<h2>Executing the processor as a command line utility<a class="headerlink" href="#executing-the-processor-as-a-command-line-utility" title="Link to this heading">#</a></h2>
<p>With the banffprocessor package installed in your python environment, the processor can be run with the following command:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>banffprocessor<span class="w"> </span><span class="s2">&quot;\path\to\your\processor_input.json&quot;</span><span class="w"> </span>-l<span class="w"> </span>fr
</pre></div>
</div>
<p>Alternatively to run as a module:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>banffprocessor.processor<span class="w"> </span><span class="s2">&quot;\path\to\your\processor_input.json&quot;</span><span class="w"> </span>--lang<span class="w"> </span>fr
</pre></div>
</div>
<ul class="simple">
<li><p><strong>NOTE</strong>: The ‘-l’/’–lang’ parameter is optional. Valid values include en and fr, if not specified, the default is set to en.</p></li>
</ul>
<section id="executing-the-processor-from-within-a-python-script">
<h3>Executing the processor from within a python script<a class="headerlink" href="#executing-the-processor-from-within-a-python-script" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">banffprocessor</span>

<span class="c1"># Optional: Set the language to fr so that log and console messages on written in French.</span>
<span class="n">banffprocessor</span><span class="o">.</span><span class="n">set_language</span><span class="p">(</span><span class="n">banffprocessor</span><span class="o">.</span><span class="n">SupportedLanguage</span><span class="o">.</span><span class="n">fr</span><span class="p">)</span>

<span class="n">bp</span> <span class="o">=</span> <span class="n">banffprocessor</span><span class="o">.</span><span class="n">Processor</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s2">&quot;path</span><span class="se">\\</span><span class="s2">to</span><span class="se">\\</span><span class="s2">my</span><span class="se">\\</span><span class="s2">input_file.json&quot;</span><span class="p">)</span>
<span class="n">bp</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="n">bp</span><span class="o">.</span><span class="n">save_outputs</span><span class="p">()</span>
</pre></div>
</div>
<p>Alternatively, you may load your input data files programmatically as Pandas DataFrames:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">banffprocessor.processor</span><span class="w"> </span><span class="kn">import</span> <span class="n">Processor</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="n">indata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">indata_aux</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">instatus</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="o">...</span>
<span class="c1"># Load your dataframes with data</span>
<span class="o">...</span>
<span class="n">bp</span> <span class="o">=</span> <span class="n">Processor</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">input_filepath</span><span class="o">=</span><span class="s2">&quot;path</span><span class="se">\\</span><span class="s2">to</span><span class="se">\\</span><span class="s2">my</span><span class="se">\\</span><span class="s2">input_file.json&quot;</span><span class="p">,</span> <span class="n">indata</span><span class="o">=</span><span class="n">indata</span><span class="p">,</span> <span class="n">instatus</span><span class="o">=</span><span class="n">instatus</span><span class="p">)</span>
<span class="n">bp</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="n">bp</span><span class="o">.</span><span class="n">save_outputs</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="user-defined-procedures">
<h2>User-Defined Procedures<a class="headerlink" href="#user-defined-procedures" title="Link to this heading">#</a></h2>
<p>In addition to the standard Banff Procedures automatically integrated into the processor, you may also include your own <code class="docutils literal notranslate"><span class="pre">.py</span></code> files implementing custom procedures. By default the Processor will look for python files placed in a <code class="docutils literal notranslate"><span class="pre">\plugins</span></code> subfolder in the same location as your input JSON file. Alternatively you may provide a specific location to load plugins from in the <code class="docutils literal notranslate"><span class="pre">user_plugins_folder</span></code> parameter of your input JSON file. You may provide as many plugin files as needed for your job, and each plugin file may contain as many procedure classes as you wish so long as each class is registered in a <code class="docutils literal notranslate"><span class="pre">register()</span></code> method.</p>
<p>Your plugin must define a class that implements the <code class="docutils literal notranslate"><span class="pre">ProcedureInterface</span></code> protocol which is found in the package’s source files at
<code class="docutils literal notranslate"><span class="pre">\src\banffprocessor\procedures\procedure_interface.py</span></code>. Your implementing class must have the exact same attribute names and function signatures as the interface does. Here is an example of a plugin that implements the protocol:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">MyProcClass</span><span class="p">:</span>
    
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">processor_data</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="c1"># These give you indata as a pyarrow Table</span>
        <span class="c1">#indata = processor_data.indata</span>
        <span class="c1">#indata = processor_data.get_dataset(&quot;indata&quot;, ds_format=&quot;pyarrow&quot;)</span>
        <span class="c1"># This gives you indata as a Pandas DataFrame</span>
        <span class="n">indata</span> <span class="o">=</span> <span class="n">processor_data</span><span class="o">.</span><span class="n">get_dataset</span><span class="p">(</span><span class="s2">&quot;indata&quot;</span><span class="p">,</span> <span class="n">ds_format</span><span class="o">=</span><span class="s2">&quot;pandas&quot;</span><span class="p">)</span>
        
        <span class="c1"># Get the uservar var1 from the metadata collection, by default a string</span>
        <span class="n">my_var1</span> <span class="o">=</span> <span class="n">processor_data</span><span class="o">.</span><span class="n">current_uservars</span><span class="p">[</span><span class="s2">&quot;var1&quot;</span><span class="p">]</span>   
        <span class="c1"># If our uservar is supposed to be numeric we would need to cast it</span>
        <span class="c1">#my_var1 = int(processor_data.current_uservars[&quot;var1&quot;])</span>
        
        <span class="c1"># Create an outdata DataFrame containing the indata record(s) with ident value R01</span>
        <span class="n">outdata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">indata</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">indata</span><span class="p">[</span><span class="s1">&#39;ident&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;R01&#39;</span><span class="p">])</span>

        <span class="c1"># We are expecting to have at least one record found</span>
        <span class="c1"># If we don&#39;t, return 1 to indicate there was an error and the job should terminate</span>
        <span class="k">if</span><span class="p">(</span><span class="n">outdata</span><span class="o">.</span><span class="n">empty</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">1</span>

        <span class="c1"># Set the v1 field in the retrieved record(s) to contain uservar value</span>
        <span class="n">outdata</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">my_var1</span>

        <span class="c1"># In order for the processor to update our imputed_file we need to set the outdata file  </span>
        <span class="n">processor_data</span><span class="o">.</span><span class="n">outdata</span> <span class="o">=</span> <span class="n">outdata</span>
        
        <span class="c1"># If we made it here return 0 to indicate there were no errors</span>
        <span class="k">return</span> <span class="mi">0</span>

<span class="c1"># Registers all plugin classes to the factory</span>
<span class="c1"># &quot;myproc&quot; is the same name you will provide in your Jobs file entries as </span>
<span class="c1"># the process name, using any capitalization you want (i.e. mYpRoC, MyProc, myProc etc.)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">register</span><span class="p">(</span><span class="n">factory</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">factory</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;myproc&quot;</span><span class="p">,</span> <span class="n">MyProcClass</span><span class="p">)</span>
    <span class="c1"># You may provide multiple names for your proc, if you like</span>
    <span class="c1">#factory.register([&quot;myproc&quot;, &quot;also_myproc&quot;], MyProcClass)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>When your <code class="docutils literal notranslate"><span class="pre">execute()</span></code> is complete, the processor automatically updates the <em>status_file</em> and/or <em>imputed_file</em> with the contents of the corresponding <em>outstatus</em>/<em>outdata</em> datasets, if you have set one.</p>
<ul>
<li><p>This operation is unable to add or remove data from your <em>imputed_file</em>, it can only update existing records. If you have a need to add or remove data from <em>imputed_file</em> you must do so in your plugin and set <code class="docutils literal notranslate"><span class="pre">processor_data.indata</span></code> to point to your updated data. This will log a warning in your log file, but it can be ignored if this was intended.</p></li>
</ul>
</li>
<li><p>Additionally, the processor automatically appends any other datasets you output from a custom plugin to a single “cumulative” version if the process_output_type is set to “All” or “Custom” and the dataset name is specified in a ProcessOutput metadata entry for that custom plugin</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">execute()</span></code> method is marked as a classmethod, which means it is first argument <code class="docutils literal notranslate"><span class="pre">cls</span></code> is a reference to <code class="docutils literal notranslate"><span class="pre">MyProcClass</span></code>. It also has a second argument <code class="docutils literal notranslate"><span class="pre">processor_data</span></code> which is an object of type <code class="docutils literal notranslate"><span class="pre">ProcessorData</span></code> (the definition of which can be found in <code class="docutils literal notranslate"><span class="pre">src\banffprocessor\processor_data.py</span></code>). This object includes input files, output files (from previously ran procedures and the current procedure), metadata and parameters from your input JSON file.</p>
<ul>
<li><p>Your <code class="docutils literal notranslate"><span class="pre">execute()</span></code> method should also return an <code class="docutils literal notranslate"><span class="pre">int</span></code> representing the return code of the plugin. Any non-0 number indicates that the plugin did not complete successfully and that the processor should stop processing subsequent steps in the imputation stategy, alternately an exception can be raised.</p></li>
</ul>
</li>
<li><p>Finally your plugin’s module must implement a <code class="docutils literal notranslate"><span class="pre">register()</span></code> function, outside of any class definitions in your plugin file. This function has one parameter <code class="docutils literal notranslate"><span class="pre">factory</span></code>. The function must call the <code class="docutils literal notranslate"><span class="pre">register()</span></code> function of the factory object, providing the name of your procedure as it will appear in your metadata and the name of the class that implements it. Though one plugin per file is recommended, if you have multiple classes in the same file that implement the Banff Procedure Interface, you can register all of them using the same register function. Just include a <code class="docutils literal notranslate"><span class="pre">factory.register(...)</span></code> call for each plugin procedure you would like to register.</p>
<ul>
<li><p><strong>NOTE</strong>: The name registered to the factory is the same name that you will provide in your Jobs entries as the name of the <code class="docutils literal notranslate"><span class="pre">process</span></code>. Process names are not case sensitive.</p></li>
</ul>
</li>
</ul>
<p>For an example of a job that includes a user-defined procedure see <code class="docutils literal notranslate"><span class="pre">banffprocessor\banff-processor\tests\integration_tests\udp_test</span></code> with the plugin located in <code class="docutils literal notranslate"><span class="pre">\plugins\my_plugin.py</span></code>.</p>
</section>
<section id="process-controls">
<h2>Process Controls<a class="headerlink" href="#process-controls" title="Link to this heading">#</a></h2>
<p><strong>Note</strong>: Process Controls are a new feature introduced with version 2.0.0 of the Python processor.</p>
<p>Process controls are processes that run before an imputation step. An example is a filter applied to the input data or status file. This allows users to define process controls that enable the processor to be more generic, reduce the number of steps in an imputation strategy and improve the information provided to subsequent processes (SEVANI).</p>
<p>This feature requires the use of a new field in the Jobs metadata file, <code class="docutils literal notranslate"><span class="pre">controlid</span></code>. This field references an entry (or entries) in a new metadata file, <em>processcontrols.xml</em> (produced from the PROCESSCONTROLS worksheet in the excel template):</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>controlid</p></th>
<th class="head"><p>targetfile</p></th>
<th class="head"><p>parameter</p></th>
<th class="head"><p>value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Identifies the control or set of controls to apply to the Jobs steps with the same controlid</p></td>
<td><p>The <a class="reference internal" href="#available-table-names">dataset name</a> to apply the control to (names should be written in the same case as they appear in the table)</p></td>
<td><p>The desired control type</p></td>
<td><p>Determined by the <a class="reference internal" href="#control-types">control type</a></p></td>
</tr>
<tr class="row-odd"><td><p><em>control1</em></p></td>
<td><p><em>indata</em></p></td>
<td><p><em>row_filter</em></p></td>
<td><p><em>strat &gt; 15 and (rec_id not in (SELECT * FROM instatus WHERE status != ‘FTI’))</em></p></td>
</tr>
<tr class="row-even"><td><p><em>control1</em></p></td>
<td><p><em>instatus</em></p></td>
<td><p><em>column_filter</em></p></td>
<td><p><em>IDENT, AREA, V1</em></p></td>
</tr>
<tr class="row-odd"><td><p><em>control1</em></p></td>
<td><p><em>indata</em></p></td>
<td><p><em>exclude_rejected</em></p></td>
<td><p><em>True</em></p></td>
</tr>
<tr class="row-even"><td><p><em>control1</em></p></td>
<td><p><em>N/A</em></p></td>
<td><p><em>edit_group_filter</em></p></td>
<td><p><em>N/A</em></p></td>
</tr>
</tbody>
</table>
</div>
<p>All process controls with the specified <code class="docutils literal notranslate"><span class="pre">controlid</span></code> are applied to their respective <code class="docutils literal notranslate"><span class="pre">targetfile</span></code>s for the single job step on which they are declared. Upon completion of the job step the affected <code class="docutils literal notranslate"><span class="pre">targetfile</span></code>s are returned to their original state and the job continues. However, if the job step begins the execution of a new process block, the <code class="docutils literal notranslate"><span class="pre">targetfile</span></code> will remain in the state created by the process control(s) applied for the duration of the process block (and any sub-blocks within).</p>
<p>One controlid may be used as many times as needed per-<code class="docutils literal notranslate"><span class="pre">targetfile</span></code>. If a controlid is repeated for the same <code class="docutils literal notranslate"><span class="pre">targetfile</span></code> AND <code class="docutils literal notranslate"><span class="pre">parameter</span></code> then the <code class="docutils literal notranslate"><span class="pre">value</span></code> for those controls is combined into one. This is intended to allow more modularity in control sets as individual parts of multi-part conditions can be interchanged as desired without affecting the other parts.</p>
<section id="control-types">
<h3>Control Types<a class="headerlink" href="#control-types" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>ROW_FILTER</p>
<ul>
<li><p>Filters <code class="docutils literal notranslate"><span class="pre">targetfile</span></code> using an SQL WHERE clause</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">value</span></code> - The SQL condition which can include column names and/or table names (exactly as shown in <a class="reference internal" href="#available-table-names">available table names</a>)</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">controlid</span></code>, <code class="docutils literal notranslate"><span class="pre">targetfile</span></code> and <code class="docutils literal notranslate"><span class="pre">parameter</span></code> are repeated for more than one entry, the conditions in their <code class="docutils literal notranslate"><span class="pre">value</span></code> fields are joined by <code class="docutils literal notranslate"><span class="pre">AND</span></code></p></li>
</ul>
</li>
<li><p>COLUMN_FILTER (can apply multiple for one ID, column name lists are combined into one)</p>
<ul>
<li><p>Filters <code class="docutils literal notranslate"><span class="pre">targetfile</span></code>’s to remove columns that don’t appear in the list in the <code class="docutils literal notranslate"><span class="pre">value</span></code> field</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">value</span></code> - A comma-separated list of column names to KEEP in <code class="docutils literal notranslate"><span class="pre">targetfile</span></code></p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">controlid</span></code>, <code class="docutils literal notranslate"><span class="pre">targetfile</span></code> and <code class="docutils literal notranslate"><span class="pre">parameter</span></code> are repeated for more than one entry, the column lists in their <code class="docutils literal notranslate"><span class="pre">value</span></code> fields are combined</p></li>
</ul>
</li>
<li><p>EXCLUDE_REJECTED</p>
<ul>
<li><p>Filters <code class="docutils literal notranslate"><span class="pre">targetfile</span></code> by removing any entries with a <code class="docutils literal notranslate"><span class="pre">unit_id</span></code> that appears in the <code class="docutils literal notranslate"><span class="pre">outreject</span></code> table</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">value</span></code> - The text ‘True’ or ‘False’, indicating if the control should be applied or not</p></li>
<li><p>For one <code class="docutils literal notranslate"><span class="pre">controlid</span></code>, only one EXCLUDE_REJECTED control may be used per-<code class="docutils literal notranslate"><span class="pre">targetfile</span></code></p></li>
<li><p><strong>NOTE</strong> Errorloc and Prorate each produce slightly <code class="docutils literal notranslate"><span class="pre">outreject</span></code> files.</p>
<ul>
<li><p>Errorloc: <code class="docutils literal notranslate"><span class="pre">outreject</span></code>, produced by the current errorloc call, overwrites any existing <code class="docutils literal notranslate"><span class="pre">outreject</span></code> file. The contents of <code class="docutils literal notranslate"><span class="pre">outreject</span></code> are also appended to <code class="docutils literal notranslate"><span class="pre">outreject_all</span></code>.</p></li>
<li><p>Prorate: The contents of the <code class="docutils literal notranslate"><span class="pre">outreject</span></code> dataset produced by the current prorate call are appended to <code class="docutils literal notranslate"><span class="pre">outreject_all</span></code> and also appended to the existing <code class="docutils literal notranslate"><span class="pre">outreject</span></code> dataset (or just set as the <code class="docutils literal notranslate"><span class="pre">outreject</span></code> table if one does not yet exist).</p></li>
</ul>
</li>
</ul>
</li>
<li><p>EDIT_GROUP_FILTER</p>
<ul>
<li><p>Filters <code class="docutils literal notranslate"><span class="pre">instatus</span></code> by removing any entries with an <code class="docutils literal notranslate"><span class="pre">editgroupid</span></code> matching the current job step OR any entries that were produced by an Outlier step with a status value of <code class="docutils literal notranslate"><span class="pre">FTI</span></code> or <code class="docutils literal notranslate"><span class="pre">FTE</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">value</span></code> and <code class="docutils literal notranslate"><span class="pre">targetfile</span></code> fields should not be given for this control type</p></li>
<li><p>Replaces existing SAS functionality where this filter was automatically applied prior to executing a <code class="docutils literal notranslate"><span class="pre">DonorImputation</span></code> or <code class="docutils literal notranslate"><span class="pre">Deterministic</span></code> proc</p></li>
</ul>
</li>
<li><p><strong>NOTE</strong>: Column names from your original input files should be referenced in their original case, those that are created or added by the Processor should be in ALL-CAPS.</p></li>
</ul>
</section>
<section id="available-table-names">
<h3>Available Table Names<a class="headerlink" href="#available-table-names" title="Link to this heading">#</a></h3>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Table Name</p></th>
<th class="head"><p>Notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>status_log</p></td>
<td><p>Contains all produced <code class="docutils literal notranslate"><span class="pre">outstatus</span></code> files appended in order</p></td>
</tr>
<tr class="row-odd"><td><p>indata</p></td>
<td><p>The input data to the current job step. Alias: imputed_file</p></td>
</tr>
<tr class="row-even"><td><p>indata_aux</p></td>
<td><p>Auxiliary input data.</p></td>
</tr>
<tr class="row-odd"><td><p>indata_hist</p></td>
<td><p>Historic input data.</p></td>
</tr>
<tr class="row-even"><td><p>instatus</p></td>
<td><p>The input status data to the current job step. Alias: status_file</p></td>
</tr>
<tr class="row-odd"><td><p>instatus_hist</p></td>
<td><p>Historic status data.</p></td>
</tr>
<tr class="row-even"><td><p>time_store</p></td>
<td><p>Information regarding the runtime and exection of each step in a job</p></td>
</tr>
<tr class="row-odd"><td><p>outreject and outreject_all</p></td>
<td><p>Produced by Errorloc and Prorate</p></td>
</tr>
<tr class="row-even"><td><p>outedit_applic</p></td>
<td><p>Can be produced by Editstats</p></td>
</tr>
<tr class="row-odd"><td><p>outedit_status</p></td>
<td><p>Can be produced by Editstats</p></td>
</tr>
<tr class="row-even"><td><p>outedits_reduced</p></td>
<td><p>Can be produced by Editstats</p></td>
</tr>
<tr class="row-odd"><td><p>outglobal_status</p></td>
<td><p>Can be produced by Editstats</p></td>
</tr>
<tr class="row-even"><td><p>outk_edits_status</p></td>
<td><p>Can be produced by Editstats</p></td>
</tr>
<tr class="row-odd"><td><p>outvars_role</p></td>
<td><p>Can be produced by Editstats</p></td>
</tr>
<tr class="row-even"><td><p>outacceptable</p></td>
<td><p>Can be produced by Estimator</p></td>
</tr>
<tr class="row-odd"><td><p>outest_ef</p></td>
<td><p>Can be produced by Estimator</p></td>
</tr>
<tr class="row-even"><td><p>outest_lr</p></td>
<td><p>Can be produced by Estimator</p></td>
</tr>
<tr class="row-odd"><td><p>outest_parm</p></td>
<td><p>Can be produced by Estimator</p></td>
</tr>
<tr class="row-even"><td><p>outrand_err</p></td>
<td><p>Can be produced by Estimator</p></td>
</tr>
<tr class="row-odd"><td><p>outmatching_fields</p></td>
<td><p>Produced by DonorImputation</p></td>
</tr>
<tr class="row-even"><td><p>outdonormap</p></td>
<td><p>Produced by DonorImputation and MassImputation</p></td>
</tr>
<tr class="row-odd"><td><p>outlier_status</p></td>
<td><p>Can be produced by Outlier</p></td>
</tr>
</tbody>
</table>
</div>
<ul class="simple">
<li><p>Optional datasets are only available during execution and saved to disk if the input parameter process_output_type is set to “All” (2) or the dataset’s name is specified in a ProcessOutput metadata table entry for the process producing it and process_output_type is set to “Custom” (3)</p></li>
<li><p>Either the table name or its alias may be used, both refer to the same table and data</p></li>
<li><p>The indata and instatus files are always available</p>
<ul>
<li><p>If instatus is the first step in a job that doesn’t provide an instatus file to start with, it is not available to be used in a filter for the first step, though it is available in subsequent steps</p></li>
</ul>
</li>
<li><p>Any procedure-specific file is not available to reference until a job step for that procedure has run in a preceding step, and only if the file referenced is produced according to the <code class="docutils literal notranslate"><span class="pre">process_output_type</span></code></p></li>
<li><p>All files will have the columns SEQNO and JOBID added. These can be filtered to obtain data from a specific job step.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">value</span></code> field supports references to tables located on-disk as well as the in-memory table names found above</p>
<ul>
<li><p>This does not apply to <code class="docutils literal notranslate"><span class="pre">targetfile</span></code>, which must be an in-memory table referenced by name</p></li>
<li><p>The filepath must either be absolute or relative to the input folder for the current job</p></li>
<li><p>The filepath should be single-quoted, e.g.:<br />
<code class="docutils literal notranslate"><span class="pre">ident</span> <span class="pre">in</span> <span class="pre">(SELECT</span> <span class="pre">ident</span> <span class="pre">FROM</span> <span class="pre">'.\subfolder\of\input_folder\idents.csv')</span></code></p></li>
<li><p>See <a class="reference external" href="https://duckdb.org/docs/stable/data/overview">DuckDB docs</a> for information on supported filetypes (i.e. only ‘.parquet’ is supported NOT ‘.parq’)</p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="process-blocks">
<h2>Process Blocks<a class="headerlink" href="#process-blocks" title="Link to this heading">#</a></h2>
<p><strong>Note</strong>: Process Blocks are a new feature introduced in version 2.0.0 of the Python processor.</p>
<p>A job in the Banff Processor is a collection of Jobs metadata table entries, all joined by a common job identifier (jobid) and processed sequentially according to the sequence number (seqno). Only a single job is specified when executing the processor, which is done by specifying the <code class="docutils literal notranslate"><span class="pre">job_id</span></code> input parameter. A Process Block is essentially a job called from within a job. Process Blocks organize jobs into sub-jobs with the following goals:</p>
<ul class="simple">
<li><p>to allow a process control to be associated with multiple job steps.</p></li>
<li><p>to allow the reuse of a sequence of steps that are repeated with different inputs.</p></li>
<li><p>to allow users to design and implement imputation strategies using a modular approach. This means that smaller jobs can be developed and tested in isolation rather than has one large job.</p></li>
</ul>
<p>Process blocks are used by setting the <em>process</em> field of a Jobs metadata table entry to <code class="docutils literal notranslate"><span class="pre">job</span></code> (rather than a traditional Banff procedure such as <code class="docutils literal notranslate"><span class="pre">prorate</span></code> or <code class="docutils literal notranslate"><span class="pre">donorimputation</span></code>) and setting the <em>specid</em> field to be the <code class="docutils literal notranslate"><span class="pre">jobid</span></code> of the process block that is to be run.</p>
<p>Process blocks can call other process blocks, providing further flexiblity. When preparing to execute the Banff <code class="docutils literal notranslate"><span class="pre">Processor</span></code>, the Jobs metadata is validated using the <code class="docutils literal notranslate"><span class="pre">job_id</span></code> input parameter as the root of the overall job structure. This validation ensures that no cycles (infinite loops) exist when the job has nested process blocks. If one is found, an error will be printed to the console and/or log file and issue will need to be corrected in order to succesfully execute the job.</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>jobid</p></th>
<th class="head"><p>seqno</p></th>
<th class="head"><p>controlid</p></th>
<th class="head"><p>process</p></th>
<th class="head"><p>specid</p></th>
<th class="head"><p>editgroupid</p></th>
<th class="head"><p>byid</p></th>
<th class="head"><p>acceptnegative</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>main_job</p></td>
<td><p>1</p></td>
<td><p><em>n/a</em></p></td>
<td><p>job</p></td>
<td><p>sub_job</p></td>
<td><p><em>n/a</em></p></td>
<td><p><em>n/a</em></p></td>
<td><p><em>n/a</em></p></td>
</tr>
<tr class="row-odd"><td><p>main_job</p></td>
<td><p>2</p></td>
<td><p><em>n/a</em></p></td>
<td><p>outlier</p></td>
<td><p>outlier_spec1</p></td>
<td><p><em>n/a</em></p></td>
<td><p><em>n/a</em></p></td>
<td><p><em>n/a</em></p></td>
</tr>
<tr class="row-even"><td><p>main_job</p></td>
<td><p>3</p></td>
<td><p><em>n/a</em></p></td>
<td><p>job</p></td>
<td><p>sub_job</p></td>
<td><p><em>n/a</em></p></td>
<td><p><em>n/a</em></p></td>
<td><p><em>n/a</em></p></td>
</tr>
<tr class="row-odd"><td><p>sub_job</p></td>
<td><p>1</p></td>
<td><p><em>n/a</em></p></td>
<td><p>prorate</p></td>
<td><p>prorate_spec1</p></td>
<td><p><em>n/a</em></p></td>
<td><p><em>n/a</em></p></td>
<td><p><em>n/a</em></p></td>
</tr>
<tr class="row-even"><td><p>sub_job</p></td>
<td><p>2</p></td>
<td><p><em>n/a</em></p></td>
<td><p>donorimp</p></td>
<td><p>donorimp_spec1</p></td>
<td><p><em>n/a</em></p></td>
<td><p><em>n/a</em></p></td>
<td><p><em>n/a</em></p></td>
</tr>
</tbody>
</table>
</div>
<p>For example, the Jobs table above would result in the execution of:</p>
<ol class="arabic simple">
<li><p>prorate (sub_job, 1)</p></li>
<li><p>donorimp (sub_job, 2)</p></li>
<li><p>outlier (main_job, 2)</p></li>
<li><p>prorate (sub_job, 1)</p></li>
<li><p>donorimp (sub_job, 2)</p></li>
</ol>
<p>A working example of a job with a Process Block can be found in the project directory under ‘examples/example4’.</p>
</section>
<section id="output">
<h2>Output<a class="headerlink" href="#output" title="Link to this heading">#</a></h2>
<section id="saving-ouputs">
<h3>Saving Ouputs<a class="headerlink" href="#saving-ouputs" title="Link to this heading">#</a></h3>
<p>If running from within a python script, output datasets can be saved to disk by calling the <code class="docutils literal notranslate"><span class="pre">save_outputs()</span></code> function of the <code class="docutils literal notranslate"><span class="pre">banffprocessor</span></code> object containing the results from a call to <code class="docutils literal notranslate"><span class="pre">execute()</span></code>. If running from command line <code class="docutils literal notranslate"><span class="pre">save_outputs()</span></code> will be called automatically once the processor has finished a job.</p>
<p>During operation, if no <code class="docutils literal notranslate"><span class="pre">output_folder</span></code> parameter is provided, the processor will create an <code class="docutils literal notranslate"><span class="pre">out</span></code> folder in the same location as your input JSON parameter file to save the Banff log as well as the output status and data files that are created during and after the execution of each Banff proc. The status and data files will be saved in the format determined by:</p>
<ol class="arabic simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">saveFormat</span></code> parameter in your input JSON file</p></li>
<li><p>If no value provided for 1., uses the same format as the file in <code class="docutils literal notranslate"><span class="pre">indata_filename</span></code></p></li>
<li><p>If neither 1. or 2. are provided, defaults to <code class="docutils literal notranslate"><span class="pre">.parq</span></code> format</p></li>
</ol>
</section>
<section id="output-files-datasets">
<h3>Output files/datasets<a class="headerlink" href="#output-files-datasets" title="Link to this heading">#</a></h3>
<p>The output files from each procedure can be retained and saved. The Processor will automatically add the columns <code class="docutils literal notranslate"><span class="pre">JOBID</span></code> and <code class="docutils literal notranslate"><span class="pre">SEQNO</span></code> to the outputs. When an output with the same name is generated and retained, the processor will append these output datasets together and the datasets will need to be filtered by <code class="docutils literal notranslate"><span class="pre">JOBID</span></code> and <code class="docutils literal notranslate"><span class="pre">SEQNO</span></code> to limit the data to a specified processing step.</p>
<section id="minimal-outputs">
<h4>Minimal Outputs<a class="headerlink" href="#minimal-outputs" title="Link to this heading">#</a></h4>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Data File</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>imputed_file</p></td>
<td><p>This data file contains the final imputed current data.</p></td>
</tr>
<tr class="row-odd"><td><p>status_file</p></td>
<td><p>This data file contains the final imputed data statuses.</p></td>
</tr>
<tr class="row-even"><td><p>status_log</p></td>
<td><p>This data file contains the history of how the statuses changed during the imputation strategy.</p></td>
</tr>
<tr class="row-odd"><td><p>outreject</p></td>
<td><p>This data file is generated by the ErrorLoc and Prorate procedures. It contains the identification of respondents that could not be processed and the reason why.</p></td>
</tr>
<tr class="row-even"><td><p>time_store</p></td>
<td><p>This data file stores the start time, end time and duration of each processing step along with the cumulative execution time.</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="optional-outputs">
<h4>Optional Outputs<a class="headerlink" href="#optional-outputs" title="Link to this heading">#</a></h4>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Data File</p></th>
<th class="head"><p>Related Procedure</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>outlier_status</p></td>
<td><p>Outlier</p></td>
<td><p>It contains the final status file including the additional variables from the <code class="docutils literal notranslate"><span class="pre">outlier_stats</span></code> option (which is always in effect in the Banff Processor).</p></td>
</tr>
<tr class="row-odd"><td><p>outmatching_fields</p></td>
<td><p>Donor Imputation</p></td>
<td><p>It contains the status of the matching fields from the <code class="docutils literal notranslate"><span class="pre">outmatching_fields</span></code> option (which is always in effect in the Banff Processor).</p></td>
</tr>
<tr class="row-even"><td><p>outdonormap</p></td>
<td><p>DonorImputation</p></td>
<td><p>It contains the identifiers of recipients that have been imputed along with their donor identifier and the number of donors tried before the recipient passed the post-imputation edits.</p></td>
</tr>
<tr class="row-odd"><td><p>outedits_reduced</p></td>
<td><p>EditStats</p></td>
<td><p>This data file contains the minimal set of edits.</p></td>
</tr>
<tr class="row-even"><td><p>outedit_status</p></td>
<td><p>EditStats</p></td>
<td><p>This data file contains the counts of records that passed, missed and failed for each edit.</p></td>
</tr>
<tr class="row-odd"><td><p>outk_edits_status</p></td>
<td><p>EditStats</p></td>
<td><p>This data file contains the distribution of records that passed, missed and failed K edits.</p></td>
</tr>
<tr class="row-even"><td><p>outglobal_status</p></td>
<td><p>EditStats</p></td>
<td><p>This data file contains the overall counts of records that passed, missed and failed.</p></td>
</tr>
<tr class="row-odd"><td><p>outedit_applic</p></td>
<td><p>EditStats</p></td>
<td><p>This data file contains the counts of edit applications of status pass, miss or fail that involve each field.</p></td>
</tr>
<tr class="row-even"><td><p>outvars_role</p></td>
<td><p>EditStats</p></td>
<td><p>This data file contains the counts of records of status pass, miss or fail for which field j contributed to the overall record status.</p></td>
</tr>
<tr class="row-odd"><td><p>outrand_err</p></td>
<td><p>Estimator</p></td>
<td><p>This dataset contains the random error report if at least one of the estimator specifications has the <code class="docutils literal notranslate"><span class="pre">RANDOMERROR</span></code> variable in the ESTIMATOR metadata table set to <code class="docutils literal notranslate"><span class="pre">Y</span></code>.</p></td>
</tr>
<tr class="row-even"><td><p>outest_ef</p></td>
<td><p>Estimator</p></td>
<td><p>This dataset contains the report on the calculation of averages for estimator functions if at least one of the estimator specifications uses an estimator function (type EF).</p></td>
</tr>
<tr class="row-odd"><td><p>outest_parm</p></td>
<td><p>Estimator</p></td>
<td><p>This dataset contains the report on imputation statistics by estimator.</p></td>
</tr>
<tr class="row-even"><td><p>outest_lr</p></td>
<td><p>Estimator</p></td>
<td><p>This dataset contains the report on the calculation of « beta » coefficients for linear regression estimators if at least one of the estimator specifications uses a linear regression (type LR).</p></td>
</tr>
<tr class="row-odd"><td><p>outacceptable</p></td>
<td><p>Estimator</p></td>
<td><p>This data file contains the report on acceptable observations retained to calculate the parameters for each estimator given in the specifications. This file can be large and can slow down execution.</p></td>
</tr>
</tbody>
</table>
</div>
<p>Notes:</p>
<ul class="simple">
<li><p>Refer to the Banff Procedure User Guide for a full description of a file generated by a Banff Procedure.</p></li>
<li><p>Optional output files will be retained if process_output_type = <code class="docutils literal notranslate"><span class="pre">all</span></code> or if process_output_type = <code class="docutils literal notranslate"><span class="pre">custom</span></code> and the dataset name is specified in the ProcessOutputs metadata for the given process.</p></li>
<li><p>Plugins may output additional optional output files.</p></li>
</ul>
</section>
</section>
<section id="the-log">
<h3>The Log<a class="headerlink" href="#the-log" title="Link to this heading">#</a></h3>
<p>The Python processor can generate an execution log which provides valuable information about the imputation process which is useful for debugging and analytical purposes. The level of information logged can be configured via the <code class="docutils literal notranslate"><span class="pre">log_level</span></code> parameter of your input JSON file.</p>
<ul class="simple">
<li><p>If 0, no log file is produced at all, only warnings, errors and a summarization of each procedure is written to the console after it is performed. This summary is always printed, even at levels 1 and 2.</p></li>
<li><p>If 1 (the default value if <code class="docutils literal notranslate"><span class="pre">log_level</span></code> is not set), the log file contains INFO-level messages, which is primarily the output from the execution of each proc from the Banff package, as well as warnings and errors.</p></li>
<li><p>Finally, if 2, the log file contains all messages from 1 as well as any DEBUG-level messages, such as more granular information about produced and processed datasets.</p></li>
</ul>
<p>The processor keeps a maximum of 6 log files at once. The most recent job is always logged to <code class="docutils literal notranslate"><span class="pre">banffprocessor.log</span></code> and when a new job is run, a number is appended to the old log file and a new log is created for the new job. The numbering goes from newest to oldest (i.e. <code class="docutils literal notranslate"><span class="pre">banffprocessor.log</span></code> is the log for the most recent job, <code class="docutils literal notranslate"><span class="pre">banffprocessor.log.1</span></code> is from the next most recent and <code class="docutils literal notranslate"><span class="pre">banffprocessor.log.5</span></code> is from the oldest job).</p>
</section>
<section id="process-block-output">
<h3>Process Block Output<a class="headerlink" href="#process-block-output" title="Link to this heading">#</a></h3>
<p>When a new process block is to be run, a special folder is created in the output folder for the calling block. This new output folder is named after the new block’s parameters and upon completion of the block will contain all of the files created by the child block. No new log file is created, however. All log outputs for child blocks can be found in the main log file found in the root input folder.</p>
</section>
</section>
</section>
<hr class="footnotes docutils" />
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id2" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>If no <code class="docutils literal notranslate"><span class="pre">JOBID</span></code> or <code class="docutils literal notranslate"><span class="pre">SEQNO</span></code> column is found in the file, they are added and their values are initialized to the input parameter <code class="docutils literal notranslate"><span class="pre">job_id</span></code> and 0 respectively. If they are present, any records with a missing <code class="docutils literal notranslate"><span class="pre">JOBID</span></code> or <code class="docutils literal notranslate"><span class="pre">SEQNO</span></code> or any records with a JOBID that is also found in your current Jobs metadata will have the values of both <code class="docutils literal notranslate"><span class="pre">JOBID</span></code> and <code class="docutils literal notranslate"><span class="pre">SEQNO</span></code> changed to NaN.</p>
</aside>
</aside>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#table-of-contents">Table of Contents</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#input-metadata-files">Input Metadata Files</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#formatting">Formatting</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-jobs-table">Example (JOBS table)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#metadata-generation-tool">Metadata Generation Tool</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#banff-processor-input-parameters">Banff Processor Input Parameters</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#executing-the-processor-as-a-command-line-utility">Executing the processor as a command line utility</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#executing-the-processor-from-within-a-python-script">Executing the processor from within a python script</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#user-defined-procedures">User-Defined Procedures</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#process-controls">Process Controls</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#control-types">Control Types</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#available-table-names">Available Table Names</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#process-blocks">Process Blocks</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#output">Output</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#saving-ouputs">Saving Ouputs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#output-files-datasets">Output files/datasets</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#minimal-outputs">Minimal Outputs</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-outputs">Optional Outputs</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-log">The Log</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#process-block-output">Process Block Output</a></li>
</ul>
</li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/en/processor-user-guide.md.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2025, Statistics Canada / Statistique Canada.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.2.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>